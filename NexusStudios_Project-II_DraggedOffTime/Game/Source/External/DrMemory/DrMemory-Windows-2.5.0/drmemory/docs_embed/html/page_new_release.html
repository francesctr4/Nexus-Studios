---
title: "New Release"
layout: default
permalink: /page_new_release.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dr. Memory
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">New Release </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md78"></a>
Versioning</h1>
<p>We use the same <a href="https://dynamorio.org/page_new_release.html">versioning scheme as DynamoRIO</a>.</p>
<h1><a class="anchor" id="autotoc_md79"></a>
Steps for Publishing a New Release</h1>
<h2><a class="anchor" id="autotoc_md80"></a>
Sanity Testing</h2>
<p>It is a good idea to perform some sanity tests on all platforms beyond what our CI tests to catch issues before a new release. Minimal tests on each platform include:</p>
<ul>
<li>Installing from the .msi installer</li>
<li>Verifying that all of the Start Menu links work properly</li>
<li>Verifying that Dr. Memory is added to the user's path</li>
<li>Dragging calc.exe onto the Dr. Memory desktop icon (on Win10, drag notepad instead as calc is launched via service)</li>
<li>Installing from the zip file</li>
<li>Running something like tests/free.exe from the cygwin and cmd command line</li>
<li>Ensure installer set up as a Visual Studio External Tool. Try running on a sample project that contains bugs. Try to test this with as many versions of Visual Studio ({2005, 2008, 2010, 2012, 2013} x {Professional, Express}) as possible.</li>
<li>Run drstrace: <code>drstrace -- calc</code> and look at the log file</li>
<li>Run symquery: <code>symquery -e free.exe -s main</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md81"></a>
Commit the Version and Changelist Changes</h2>
<p>Update the following in the code and commit the change:</p>
<ul>
<li>Update <code>VERSION_NUMBER_DEFAULT</code></li>
<li>Potentially update <code>DynamoRIO_VERSION_REQUIRED</code></li>
<li>Potentially update <code>DRMF_VERSION_DEFAULT</code></li>
<li>Update the default version number in <code>ci-package.yml</code></li>
<li>Update the release changelist.</li>
</ul>
<h2><a class="anchor" id="autotoc_md82"></a>
Trigger a Package Build</h2>
<p>To create a new build:</p>
<ol type="1">
<li>Go to the Actions tab for the DynamoRIO/drmemory repository.</li>
<li>Click on "ci-package" on the list of workflows on the left.</li>
<li>Click on "Run workflow" on the right.</li>
<li>Select the branch.</li>
<li>Fill in the version number. For a test build or periodic build (i.e., not an official new-version-number release), use the current version major.minor and the date-based patchlevel. The patchlevel can be found from CMake's configuration output by running <code>cmake .</code>: <div class="fragment"><div class="line">-- Dr. Memory version number: 2.3.18609</div>
</div><!-- fragment --></li>
</ol>
<p>For the build number, start at 0 for any given version number and add 1 for each attempt to produce a successful build. If the build number is 0 it is not appended to the version number.</p>
<p>Wait for the workflow to finish. It should create a new tag, a new Release, upload 4 binary packages to the Release, and update the online documentation.</p>
<h2><a class="anchor" id="autotoc_md83"></a>
Verify Package and Documentation Uploads</h2>
<p>Double-check that all binary package files were uploaded to the new release on Github.</p>
<h2><a class="anchor" id="autotoc_md84"></a>
Trigger a Documentation Build</h2>
<p>Run the "ci-docs" Action in the same manner as the "ci-package" action above. Double-check that the documentation was pushed to <a href="http://drmemory.org">http://drmemory.org</a>.</p>
<h2><a class="anchor" id="autotoc_md85"></a>
Update the Release Description</h2>
<p>Once the build is finished and posted to <a href="https://github.com/DynamoRIO/drmemory/releases">https://github.com/DynamoRIO/drmemory/releases</a>, edit the description to list the highlights of the new release. You can use markdown to make a bulleted list.</p>
<h2><a class="anchor" id="autotoc_md86"></a>
Update download.dox</h2>
<p>Make a new list of direct links for the new version.</p>
<h2><a class="anchor" id="autotoc_md87"></a>
Add a New Changelist Section</h2>
<p>Update the changelist in release.dox: create a new entry for the next release.</p>
<h1><a class="anchor" id="autotoc_md88"></a>
Old Instructions for Locally Building Packages</h1>
<h2><a class="anchor" id="autotoc_md89"></a>
Setup for Building Release Packages</h2>
<p>First, set up a symlink or NTFS junction such that the source path to Dr. Memory looks "professional", for the replace_malloc frames. For example, here is what I did on Windows:</p>
<div class="fragment"><div class="line">cd /d</div>
<div class="line">cmd /c mklink /J drmemory_package <span class="stringliteral">&#39;d:\derek\drmemory\trunk&#39;</span></div>
</div><!-- fragment --><p>And on Linux:</p>
<div class="fragment"><div class="line">ln -s /work/drmemory/drmemory/src /work/drmemory_package</div>
</div><!-- fragment --><p>When I build pointing at d:/drmemory_package/package.cmake, error messages then look like this:</p>
<div class="fragment"><div class="line">Error #4: INVALID HEAP ARGUMENT to free 0x00001230</div>
<div class="line"><span class="preprocessor"># 0 replace_free               [# 1 main                       [d:\derek\drmemory\git\src\tests\malloc.c:175](d:\drmemory_package\common\alloc_replace.c:2352])</span></div>
<div class="line"><span class="preprocessor">Note: @0:00:00.344 in thread 3224</span></div>
</div><!-- fragment --><p>Next, be sure to use doxygen &gt;= 1.8.1 for high-quality documentation. On Windows, use a non-Cygwin build (I use <a href="ftp://ftp.stack.nl/pub/users/dimitri/doxygen-1.8.1.1.windows.bin.zip">ftp://ftp.stack.nl/pub/users/dimitri/doxygen-1.8.1.1.windows.bin.zip</a>, with doxygen.exe placed in /usr/local/bin: see <a href="https://github.com/DynamoRIO/dynamorio/issues/815">DR issue 815</a>).</p>
<p>On Windows, we prefer our WIX-based MSI installer over the older NSIS installer. Ensure you have at least CMake 3.3.0, WIX is installed, and WIX's <code>candle.exe</code> is on your PATH. The configure status lines should then indicate the selection of WIX instead of NSIS for the installer build.</p>
<p>To instead build an NSIS-based installer, ensure you have NSIS installed with large string support so that the installer will be properly built. Configure status lines will indicate this. See <a href="How-To-Build#other-tools">the build instructions</a> for more information.</p>
<h2><a class="anchor" id="autotoc_md90"></a>
Building Candidate Packages</h2>
<p>Build using package.cmake, and ensure your drmemory_package sources are up to date. On Windows:</p>
<div class="fragment"><div class="line">cd ~/drmemory/build_package/</div>
<div class="line">compilerVS2010_32</div>
<div class="line">ctest -VV -S d:/drmemory_package/package.cmake,drmem_only;build=2;cacheappend=TOOL_VERSION_NUMBER:STRING=1.11.0;cacheappend=DRMF_VERSION:STRING=1.0.0;use_ninja;cpackappend=set\&zwj;(CPACK_PACKAGE_FILE_NAME\ DrMemory-Windows-1.11.0-2\&zwj;);cacheappend=VERSION_NUMBER:STRING=6.2.0</div>
<div class="line">chmod ugo+rx *.msi</div>
</div><!-- fragment --><p>On Linux:</p>
<div class="fragment"><div class="line">cd /work/drmemory/build_package/</div>
<div class="line">ctest -V -S ctest -V -S /work/drmemory_package/package.cmake,drmem_only;build=2;cacheappend=TOOL_VERSION_NUMBER:STRING=1.11.0;cacheappend=DRMF_VERSION:STRING=1.0.0;cpackappend=set\&zwj;(CPACK_PACKAGE_FILE_NAME\ DrMemory-Linux-1.11.0-2\&zwj;);cacheappend=VERSION_NUMBER:STRING=6.2.0</div>
</div><!-- fragment --><p>ARM eabihf: </p><div class="fragment"><div class="line">cd /work/drmemory/build_package/</div>
<div class="line">ctest -D CMAKE_SYSTEM_PROCESSOR=arm -V -S /work/drmemory_package/package.cmake,drmem_only;32_only;build=2;cacheappend=TOOL_VERSION_NUMBER:STRING=1.11.0;cacheappend=DRMF_VERSION:STRING=1.0.0;cacheappend=CMAKE_TOOLCHAIN_FILE=/work/drmemory/git/src/dynamorio/make/toolchain-arm32.cmake;cpackappend=set\&zwj;(CPACK_PACKAGE_FILE_NAME\ DrMemory-ARM-Linux-EABIHF-1.11.0-2\&zwj;);cacheappend=VERSION_NUMBER:STRING=6.2.0</div>
</div><!-- fragment --><p>Android:</p>
<div class="fragment"><div class="line">cd /work/drmemory/build_package/</div>
<div class="line">ctest -D CMAKE_SYSTEM_PROCESSOR=arm -V -S /work/drmemory_package/package.cmake,drmem_only;32_only;build=2;cacheappend=TOOL_VERSION_NUMBER:STRING=1.11.0;cacheappend=DRMF_VERSION:STRING=1.0.0;cacheappend=CMAKE_TOOLCHAIN_FILE=/work/drmemory/git/src/dynamorio/make/toolchain-android.cmake;cacheappend=ANDROID_TOOLCHAIN=/work/toolchain/android-ndk-21;cpackappend=set\&zwj;(CPACK_PACKAGE_FILE_NAME\ DrMemory-ARM-Android-EABI-1.11.0-2\&zwj;);cacheappend=VERSION_NUMBER:STRING=6.2.0</div>
</div><!-- fragment --><p>On MacOS:</p>
<div class="fragment"><div class="line">cd ~/drmemory/build_package</div>
<div class="line">ctest -V -S /drmemory_package/package.cmake,drmem_only;32_only;build=2;cacheappend=TOOL_VERSION_NUMBER:STRING=1.11.0;cacheappend=DRMF_VERSION:STRING=1.0.0;cpackappend=set\&zwj;(CPACK_PACKAGE_FILE_NAME\ DrMemory-MacOS-1.11.0-2\&zwj;);cacheappend=VERSION_NUMBER:STRING=6.2.0</div>
</div><!-- fragment --><p>Increment the build number for each RC.</p>
<h2><a class="anchor" id="autotoc_md91"></a>
Tag and Post</h2>
<p>Tag the release point:</p>
<div class="fragment"><div class="line">git tag release_1.9.0 09e3d62</div>
<div class="line">git push origin --tags</div>
</div><!-- fragment --><p>Then make a new release on github at <a href="https://github.com/DynamoRIO/drmemory/releases">https://github.com/DynamoRIO/drmemory/releases</a>. Point at the precise changelist version in the online source viewer (look at prior releases for examples).</p>
<p>Update download.dox</p>
<p>Then commit to the top-level CMakeLists.txt (yes, <em>after</em> the tag) to update the line that sets <code>VERSION_NUMBER_DEFAULT</code>, potentially the lines that set <code>DynamoRIO_VERSION_REQUIRED</code> and <code>DRMF_VERSION_DEFAULT</code>, and the release changelist.</p>
<h2><a class="anchor" id="autotoc_md92"></a>
Update Documentation</h2>
<p>Update the online docs. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.19-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  Dr. Memory version 2.5.0 --- Mon Oct 18 2021 03:09:18 &nbsp; <img border=0 src="favicon.png">
</small></address>
