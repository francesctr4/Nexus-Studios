---
title: "Building from Sources"
layout: default
permalink: /page_build.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dr. Memory
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Building from Sources </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md21"></a>
Source Code</h1>
<p>The source code can be obtained from our git repository. Be sure to run the <code>devsetup.sh</code> script to set up the git aliases for <a class="el" href="page_contribute.html">our workflow</a>.</p>
<div class="fragment"><div class="line">$ git clone https:<span class="comment">//github.com/DynamoRIO/drmemory.git</span></div>
<div class="line">$ cd drmemory</div>
<div class="line">$ make/git/devsetup.sh</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Pre-Built Packages</h1>
<p>If you don't need to modify Dr. Memory and just want a build more recent than the last official release, we provide [weekly package builds](Latest-Build).</p>
<h1><a class="anchor" id="autotoc_md23"></a>
GitHub Zip Download Not Supported</h1>
<p>We do not support building from the "Download Zip" GitHub feature, as it A) fails to support submodules and B) thwarts our patchlevel setting mechanism (xref <a href="https://github.com/DynamoRIO/dynamorio/issues/1565">https://github.com/DynamoRIO/dynamorio/issues/1565</a>).</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Components</h1>
<p>The Dr. Memory code base contains two tools:</p><ol type="1">
<li>Dr. Memory: memory debugging tool</li>
<li>Dr. Heapstat: memory profiling tool</li>
</ol>
<p>Which tool to build is determined by whether the TOOL_DR_HEAPSTAT CMake variable is enabled.</p>
<p>Both tools use the <a href="http://dynamorio.org">DynamoRIO dynamic instrumentation tool platform</a>. The sources for the version of DynamoRIO needed is included as a git submodule in the dynamorio/ subdirectory. By default, a Dr. Memory build also builds DynamoRIO from these embedded sources. You can also point at a separate DynamoRIO build if you have built it or downloaded it separately, using the DynamoRIO_DIR CMake variable.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Windows Setup</h1>
<p>You'll need to install a compiler, the Debugging Tools for Windows, CMake, and a few other tools in order to build Dr. Memory on Windows. Since Dr. Memory also builds DynamoRIO, you can follow the <a href="https://dynamorio.org/page_building.html">setup instructions for DynamoRIO</a>. We summarize what is needed here for the specific DynamoRIO build built by Dr. Memory.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Compiler</h2>
<p>For the compiler, install Visual Studio 2013. We have never tested building from within the Visual Studio IDE, but it should work (CMake can generate Visual Studio project files as well as Makefiles). If you try it, please update these instructions. From the command line, set up the path and environment variables for Visual Studio as normal: run the <code>vcvars</code> batch file, either manually in a cmd shell or by running the Visual Studio Command Prompt which has a Start Menu entry under Visual Studio Tools, or translate the vcvars environment variables into cygwin bash.</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Debugging Tools for Windows</h2>
<p>Dr. Memory needs redistributable copies of dbghelp.dll and symsrv.dll. These are available in a Visual Studio or SDK installation that has the Remote Debugger installed, in the Windows 8 SDK, and in the WDK or DDK. Visual Studio Express seems to have the right files but has not been tested for all versions.</p>
<p>If you choose to use the WDK or DDK, we have tested the Windows Driver Kit version 7.1.0 (7600.16385.1), the Windows Vista WDK (6000), and the Windows 2003 DDK (3790.1830). If you install into a non-default location (i.e., other than <code>$SYSTEMDRIVE/WINDDK/3790.1830</code> or <code>$SYSTEMDRIVE/WINDDK/6000</code>) then you must point the DDKROOT environment variable at the base of the DDK/WDK:</p>
<div class="fragment"><div class="line">export DDKROOT=`cygpath -dm ~/WINDDK/6000/`</div>
</div><!-- fragment --><p>Alternatively, you can point at a redistributable copy of dbghelp.dll of at least version 6.3 with the CMake variable DBGHELP_DLL and at a version of symsrv.dll with the CMake variable SYMSRV_DLL.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
CMake</h2>
<p>You need CMake for Windows (<em>not</em> for Cygwin, as we need to pass paths with drive letters to our compiler), at least version 3.7. You can download a binary installation here:</p>
<p><a href="http://www.cmake.org/cmake/resources/software.html">http://www.cmake.org/cmake/resources/software.html</a></p>
<p>Install CMake and put its bin directory on the path for your shell.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Other Tools</h2>
<p>To build the Dr. Heapstat data visualizer, the Flex SDK and Java are required. We have tested versions 3.3, 3.4, and 4.1 of the Flex SDK. It can be obtained from <a href="http://www.adobe.com/go/flex4_sdk">http://www.adobe.com/go/flex4_sdk</a>. Set the CMake variable BUILD_VISUALIZER to ON, and then set the CMake variable FLEX_SDK to point at the base of the directory where you unzipped the SDK files, or set the FLEXROOT environment variable to point there:</p>
<div class="fragment"><div class="line">export FLEXROOT=/home/bruening/work/flex_sdk_4.1</div>
</div><!-- fragment --><p>For Java, if the java interpreter is not found by CMake, set the JAVA CMake variable. On Windows all that's needed is the Java runtime environment (e.g., from <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>).</p>
<p>You can build the Dr. Heapstat data gathering tool without either Flex or Java. By default, that's what is built: only if the BUILD_VISUALIZER CMake variable is enabled is the visualizer built. Be aware that the visualizer is a prototype built several years ago and it may not work out of the box on modern browsers, in particular on Windows. We are looking for contributors to build a new visualizer.</p>
<p>In order to build the documentation, you will additionally need doxygen, which can be either a Cygwin package or native Windows. Currently the documentation is always built, so this is required.</p>
<p>To build a Windows installation packagage (with an installer, instead of just a zip file for local installs), you will need to have <a href="http://nsis.sourceforge.net">NSIS</a> installed. If NSIS is not found, there will not be an error, but only the zip package on Windows will be built. Your NSIS install must be patched with the <a href="http://nsis.sourceforge.net/Special_Builds">"Large Strings" build</a> in order to support long PATHs. A configure-time check ensures this is in place. See <a href="http://code.google.com/p/drmemory/issues/detail?id=1029">Issue 1029</a> for more information.</p>
<p>In order to build DynamoRIO you must have a version of perl. It can be either a Cygwin perl or a native Windows perl.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md31"></a>
Linux Setup</h1>
<p>In order to build you'll need the following packages:</p>
<ul>
<li>gcc</li>
<li>binutils</li>
<li>cmake (at least version 3.7)</li>
<li>perl</li>
<li>libunwind-dev</li>
</ul>
<p>To build Dr. Heapstat you will additionally need:</p>
<ul>
<li>Flex SDK</li>
<li>Java</li>
</ul>
<p>In order to build the documentation, you will additionally need:</p>
<ul>
<li>doxygen</li>
</ul>
<p>If your machine does not have support for running 32-bit applications and its version of binutils is older than 2.18.50 then you'll need to set the <code>CMAKE_ASM_COMPILER</code> CMake cache variable to point at a GNU assembler of at least version 2.18.50.</p>
<p>If you're using a 64-bit Linux distribution, be sure to install 32-bit development support (for Ubuntu, the <code>g++-multilib</code> package).</p>
<hr  />
<h1><a class="anchor" id="autotoc_md33"></a>
Building with CMake</h1>
<p>If you have all the required tools installed in standard locations, CMake will find them automatically. Only the Flex SDK and the DDK (which is only needed with non-full installations of Visual Studio) are likely to not be found as they do not normally live in system install directories. If you set the FLEXROOT and DDKROOT environment variables as specified above, then CMake should find all your tools without any custom CMake variable settings.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Configuring Your Build</h2>
<p>First, configure your compiler. On Windows this means setting up the environment variables (including <code>PATH</code>). On Linux, if your compiler supports both 64-bit and 32-bit targets, you can select the non-default type by setting the <code>CFLAGS</code> and <code>CXXFLAGS</code> environment variables to the flags used to change your compiler's target. For example, for gcc:</p>
<div class="fragment"><div class="line">export CXXFLAGS=-m32</div>
<div class="line">export CFLAGS=-m32</div>
</div><!-- fragment --><p>Next, in your shell (which you have set up for building with your compiler), create a build directory. Out-of-source builds are supported and recommended.</p>
<p>You can configure using the CMake GUI or directly from the command line. We describe the GUI method first. To use the GUI, invoke it from the build directory, pointing at the source directory. For example, if your current directory is the base of the DynamoRIO tree:</p>
<p>On Windows, from a Cygwin bash shell: </p><div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">CMakeSetup ..</div>
</div><!-- fragment --><p>On Linux: </p><div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake-gui ..</div>
</div><!-- fragment --><p>Alternatively, <code>ccmake</code>, the curses-based GUI, can be used on Linux.</p>
<p>On Windows, press "Configure" and select "Visual Studio 9 2008" or "Visual
Studio 8 2005); on Linux, press Configure and then select "Unix Makefiles" (or, in <code>ccmake</code>, press <code>c</code> once).</p>
<p>Now you can select the parameters to configure your build. The main parameters are as follows:</p>
<ul>
<li>TOOL_DR_HEAPSTAT = whether to build Dr. Heapstat instead of Dr. Memory</li>
<li>CMAKE_BUILD_TYPE = whether to build Debug or RelWithDebInfo</li>
</ul>
<p>Note that the DynamoRIO build options are present as advanced options but in general should be ignored as Dr. Memory sets the appropriate settings.</p>
<p>Press Configure and then OK (or <code>c</code> and then <code>g</code>) to complete the configuration step and generate the Makefiles. It is normal to see messages like this for various types (uint, ushort, bool, byte, sbyte, uint32, uint64, int32, int64):</p>
<div class="fragment"><div class="line">-- Check size of <span class="keywordtype">bool</span></div>
<div class="line">-- Check size of <span class="keywordtype">bool</span> - failed</div>
</div><!-- fragment --><p>This is really a check for the existence of a typedef and it is normal for some such checks to print a "failure" message.</p>
<p>On Windows, if you have both <code>cl</code> and <code>gcc</code> on your path, you can ensure that CMake selects <code>cl</code> by setting the <code>CC</code> and <code>CXX</code> environment variables. For example:</p>
<div class="fragment"><div class="line">CC=cl CXX=cl cmake ..</div>
</div><!-- fragment --><p>To improve compilation speed on Windows, if you have CMake 2.8 or later, you can turn off the progress and status messages with this CMake define:</p>
<div class="fragment"><div class="line">-DCMAKE_RULE_MESSAGES:BOOL=OFF</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md35"></a>
Building and Installing</h2>
<p>After the configuration step is complete, type <code>cmake --build .</code> on Windows or <code>make</code> on Linux.</p>
<p>For a release build on Windows, you'll need to use: </p><div class="fragment"><div class="line">cmake --build . --config RelWithDebInfo</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md36"></a>
Configuring in Batch Mode</h2>
<p>Instead of interactive configuration you can pass all your parameter changes to CMake on the command line. For example:</p>
<p>On Windows, with code checked out into the current directory named <code>src</code>: </p><div class="fragment"><div class="line">mkdir ../build</div>
<div class="line">cd ../build</div>
<div class="line">cmake -G<span class="stringliteral">&quot;Visual Studio 9 2008&quot;</span> -DCMAKE_BUILD_TYPE=Debug ../src</div>
<div class="line">cmake --build .</div>
</div><!-- fragment --><p>On Linux, with code checked out into the current directory named <code>src</code>: </p><div class="fragment"><div class="line">mkdir ../build</div>
<div class="line">cd ../build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Debug ../src</div>
<div class="line">make</div>
</div><!-- fragment --><p>Developers may wish to pass <code>-DCMAKE_VERBOSE_MAKEFILE=1</code> to CMake in order to see the compilation command lines. They can alternatively be seen for any individual build with <code>make VERBOSE=1</code>.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Re-Configuring</h2>
<p>You can re-run the configure step, using the same parameters that you originally used, in two ways:</p>
<div class="fragment"><div class="line">make rebuild_cache</div>
</div><!-- fragment --><p>Or:</p>
<div class="fragment"><div class="line">cmake .</div>
</div><!-- fragment --><p>With the latter command you can also change the configuration, but be sure to do a <code>make clean</code> prior to building as CMake does not perform dependence checking on this type of modification. As an example:</p>
<div class="fragment"><div class="line">cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo .</div>
<div class="line">make clean</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
Using Ninja For Better Error Messages, Faster Builds, and Proper Incremental Builds</h2>
<p>Ninja is a new build system that provides a much better build experience from the command line. We highly recommend using it on Windows. Follow the <a href="https://dynamorio.org/page_building.html#sec_ninja">DynamoRIO instructions for using Ninja</a>.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Using MSBuild For Better Error Messages And Faster Builds</h2>
<p>We recommend Ninja (see above) over MSBuild, but we're leaving the information on MSBuild here as it is recommended over devenv.</p>
<p>By default, CMake will use devenv when building for Visual Studio generators. An exception is CMake 2.8.4, which uses MSBuild by default, but does not build in parallel without passing the "/m" flag to MSBuild:</p>
<div class="fragment"><div class="line">cmake --build . --target RelWithDebInfo -- /m</div>
</div><!-- fragment --><p>MSBuild summarizes all build warnings and errors at the end of the run, unlike devenv. It is also a little faster than devenv (when parallel building is enabled). There are some general outstanding issues with MSBuild, but it seems to work well for Dr. Memory with Visual Studio 2010. To request MSBuild set the CMAKE_MAKE_PROGRAM variable at configuration time. In a Visual Studio Command Prompt, MSBuild is on the PATH, so the absolute path is not needed (here the code is checked out into the current directory named <code>src</code>):</p>
<div class="fragment"><div class="line">cmake -G<span class="stringliteral">&quot;Visual Studio 10&quot;</span> -DCMAKE_MAKE_PROGRAM:FILEPATH=MSBuild ../src</div>
</div><!-- fragment --><p>Don't forget to pass the "/m" flag (after "--") as shown above when building.</p>
<p>To request verbose build information, use the "/v:diag" flag:</p>
<div class="fragment"><div class="line">cmake --build . --target RelWithDebInfo -- /m /v:diag</div>
</div><!-- fragment --><p>Here is a sample bash function to make building easier within Cygwin:</p>
<div class="fragment"><div class="line"><span class="keyword">function</span> build {</div>
<div class="line">    config=`grep ^CMAKE_CONFIGURATION_TYPES:S CMakeCache.txt | sed <span class="stringliteral">&#39;s/^.*=//&#39;</span>`</div>
<div class="line">    /usr/bin/time cmake --build . --config $config -- /m</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md40"></a>
Building the Qt Dr. Heapstat visualizer</h2>
<p>See the <a href="https://dynamorio.org/page_building.html#sec_drgui">Qt DrGUI extension build instructions for DynamoRIO</a>.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md42"></a>
Cross-Compiling for ARM on Linux</h2>
<p>Install the cross compiler for the <code>gnueabihf</code> target:</p>
<div class="fragment"><div class="line">$ sudo apt-get install gcc-arm-linux-gnueabihf binutils-arm-linux-gnueabihf g++-arm-linux-gnueabihf</div>
</div><!-- fragment --><p>Check out the sources as normal, and point at our toolchain CMake file:</p>
<div class="fragment"><div class="line">$ git clone https:<span class="comment">//github.com/DynamoRIO/drmemory.git</span></div>
<div class="line">$ cd drmemory</div>
<div class="line">$ make/git/devsetup.sh</div>
<div class="line">$ cd ..</div>
<div class="line">$ mkdir build_arm</div>
<div class="line">$ cd build_arm</div>
<div class="line">$ cmake -DCMAKE_TOOLCHAIN_FILE=../drmemory/dynamorio/make/toolchain-arm32.cmake ../drmemory</div>
<div class="line">$ make -j</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md44"></a>
Cross-Compiling for ARM Android</h2>
<p>Install the Android NDK and configure it for the androideabi standalone toolchain. Something like this:</p>
<div class="fragment"><div class="line">/myndkpath/android-ndk-r10e/build/tools/make-standalone-toolchain.sh --arch=arm --platform=android-21 --install-dir=/mytooldir/android-ndk-21 --toolchain=arm-linux-androideabi-4.9</div>
</div><!-- fragment --><p>Switch from the gold linker to bfd:</p>
<div class="fragment"><div class="line">ln -sf arm-linux-androideabi-ld.bfd /mytooldir/android-ndk-21/bin/arm-linux-androideabi-ld</div>
</div><!-- fragment --><p>You'll need a cmake version greater than 3.0.2 &ndash; otherwise you'll see this error:</p>
<div class="fragment"><div class="line">System is unknown to cmake, create:</div>
<div class="line">Platform/Android to use <span class="keyword">this</span> system, please send your config file to ...</div>
</div><!-- fragment --><p>Now check out the sources as normal, and point at our toolchain CMake file.</p>
<div class="fragment"><div class="line">$ git clone https:<span class="comment">//github.com/DynamoRIO/drmemory.git</span></div>
<div class="line">$ cd drmemory</div>
<div class="line">$ make/git/devsetup.sh</div>
<div class="line">$ cd ..</div>
<div class="line">$ mkdir build_android</div>
<div class="line">$ cd build_android</div>
<div class="line">$ cmake -DCMAKE_TOOLCHAIN_FILE=../drmemory/dynamorio/make/toolchain-android.cmake -DANDROID_TOOLCHAIN=/mytooldir/android-ndk-21 ../drmemory</div>
<div class="line">$ make -j</div>
</div><!-- fragment --><p>If your Android system does not have a writable <code>/data/local/tmp</code> directory, you will need to either set <code>DYNAMORIO_CONFIGDIR</code> to a writable location or always run from a writable current directory.</p>
<p>If you have an Android device set up for access through the <code>adb shell</code> utility, the Android build is capable of automatically copying binaries to the device and running tests. First, ensure that <code>adb</code> is on your PATH, and that <code>adb status</code> indicates an attached device. Next, set the cmake variable <code>DRM_COPY_TO_DEVICE</code>. This sets up post-build steps for each target needed by the tests to copy binaries over to the device. Now <code>ctest</code> should work when run from the host machine.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md46"></a>
Building a Release Package</h1>
<p>We use Github Actions to build official release packages of Dr. Memory. This section describes how to build a local package.</p>
<p>Use the package.cmake CTest script to build a release package. On Linux, this is a tarball; on Windows, both a zip file and an installation executable are built. The Windows installer is only built, however, if <a href="http://nsis.sourceforge.net">NSIS</a> is installed on your machine. See the instructions under Other Tools for how to appropriately patch NSIS.</p>
<p>Launch package.cmake using <code>ctest -S</code>. Here is an example of building a Dr. Memory package from the current sources:</p>
<div class="fragment"><div class="line">git clone https:<span class="comment">//github.com/DynamoRIO/drmemory.git</span></div>
<div class="line">cd drmemory</div>
<div class="line">make/git/devsetup.sh</div>
<div class="line">cd ..</div>
<div class="line">mkdir build_package</div>
<div class="line">cd build_package</div>
<div class="line">ctest -S ../drmemory/package.cmake,drmem_only;build=1</div>
</div><!-- fragment --><p>The arguments to a ctest script are ;-separated (but the ; must be escaped for most shells) and separated from the script name by a comma.</p>
<p>To set a CMake variable for a CTest script, create a file and pass it in via the preload argument to package.cmake.</p>
<p>To diagnose build failures, look at the detailed output in the log files for each step (configure, build, test) in the <code>Testing/Temporary/</code> directory inside each build directory. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.19-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  Dr. Memory version 2.5.0 --- Mon Oct 18 2021 03:09:18 &nbsp; <img border=0 src="favicon.png">
</small></address>
