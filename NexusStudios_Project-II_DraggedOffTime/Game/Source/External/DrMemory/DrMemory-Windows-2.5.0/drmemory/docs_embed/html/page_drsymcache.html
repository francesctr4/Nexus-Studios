---
title: "Dr. SymCache: Symbol Lookup Cache Extension"
layout: default
permalink: /page_drsymcache.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dr. Memory
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Dr. SymCache: Symbol Lookup Cache Extension </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Dr. SymCache (<code>drsymcache</code>) DynamoRIO Extension provides caching of symbol lookup results. Symbol lookup can be very expensive for large applications, resulting in startup overhead measuring in the minutes in some cases. Dr. SymCache provides a persistent caching facility that stores lookup results on disk and loads them again on subsequent runs. Dr. SymCache is part of the Dr. Memory Framework.</p>
<ul>
<li><a class="el" href="page_drsymcache.html#sec_drsymcache_setup">Setup</a></li>
<li><a class="el" href="page_drsymcache.html#sec_drsymcache_events">Event Replacement</a></li>
<li><a class="el" href="page_drsymcache.html#sec_drsymcache_API">Dr. SymCache API</a></li>
</ul>
<h1><a class="anchor" id="sec_drsymcache_setup"></a>
Setup</h1>
<p>To use <code>drsymcache</code> with your client, first locate the Dr. Memory Framework. Then use the standard method of using an Extension with the name <code>drsymcache</code>. The two steps will look like this in your client's <code>CMakeLists.txt</code> file:</p>
<div class="fragment"><div class="line">find_package(DrMemoryFramework)</div>
<div class="line">use_DynamoRIO_extension(clientname drsymcache)</div>
</div><!-- fragment --><p>To point CMake at the framework, set the DrMemoryFramework_DIR variable to point at the <code>drmf</code> subdirectory of the Dr. Memory package that you are using. For example:</p>
<div class="fragment"><div class="line">cmake -G<span class="stringliteral">&quot;Ninja&quot;</span> -DDynamoRIO_DIR=c:/path/to/DynamoRIO-Windows-4.1.0-8/cmake -DDrMemoryFramework_DIR=c:/path/to/DrMemory-Windows-1.6.0-2/drmf ../mysrcs/</div>
</div><!-- fragment --><p>That will automatically set up the include path and library dependence.</p>
<p>Your client must call <code><a class="el" href="drsymcache_8h.html#ae20727ceefa9b26b5d9851b6dbae8a7b">drsymcache_init()</a></code> prior to accessing any API routines in Dr. Symcache, and should call <code><a class="el" href="drsymcache_8h.html#ac93f61aab50f0b1e2da8c08d8108d3d6">drsymcache_exit()</a></code> at process exit time.</p>
<h1><a class="anchor" id="sec_drsymcache_events"></a>
Event Replacement</h1>
<p>Dr. Symcache uses the <code>drmgr</code> Extension to ensure its events occur at the proper order. A user of Dr. SymCache must use the <code>drmgr</code> versions of the module load and unload events.</p>
<h1><a class="anchor" id="sec_drsymcache_API"></a>
Dr. SymCache API</h1>
<p>Dr. SymCache provides persistent caching of symbol locations on disk. It caches symbols on a per-application-module bases. The only data stored for each symbol name is a list of offsets from the module base at which that symbol appears. Negative entries (where a symbol is not present in the module) are indicated by storing a 0 offset. Dr. SymCache's usage model assumes that if a symbol is present in its cache, then all values of that symbol are present.</p>
<p>Dr. SymCache relies on the user to instruct it in which symbols and offsets should be cached. It uses an in-memory cache to answer later queries about symbols. At several points during execution, the in-memory cache is written to disk in a symbol file that is automatically loaded in subsequent executions.</p>
<p>Dr. SymCache registers a high-priority module load event with <code>drmgr</code>. In this event, it looks for and loads symbol files from disk. The user can then query Dr. SymCache for each symbol it wants to look up, and only go to a full lookup (via <code>drsyms</code> or some other method) if the entry is not found or there is no symbol cache for the module in question yet.</p>
<p>The on-disk symbol file contains both self-consistency checks (to guard against corruption or truncation) and module consistenty checks, so that it will be automatically invalidated and replaced if an application module changes (e.g., through a software updated).</p>
<p>Symbol files are stored in a directory passed to <code><a class="el" href="drsymcache_8h.html#ae20727ceefa9b26b5d9851b6dbae8a7b">drsymcache_init()</a></code>. This directory must be writable by the applications being executed.</p>
<p>Modules with no names (i.e., dr_module_preferred_name() returns NULL) are currently not supported by Dr. SymCache. Symbol files on disk are named according to the dr_module_preferred_name() label for each module. This leads to the current limitation that side-by-side modules with identical names will collide in the cache. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.19-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  Dr. Memory version 2.5.0 --- Mon Oct 18 2021 03:09:18 &nbsp; <img border=0 src="favicon.png">
</small></address>
